<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Fundamentals for Puppet</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>

  <link rel="stylesheet" href=".//css/reset.css" type="text/css"/>

  
  <link rel="icon" href="image/global/favicon.ico"/>
  

  <link type="text/css" href=".//css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href=".//css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href=".//css/sh_style.css" rel="stylesheet" />
  <link type="text/css" href=".//css/tipsy.css" rel="stylesheet" />

  <link rel="stylesheet" href=".//css/showoff.css" type="text/css"/>

  <script type="text/javascript" src=".//js/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src=".//js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src=".//js/jquery-print.js"></script>
  <script type="text/javascript" src=".//js/jquery.batchImageLoad.js"></script>
  <script type="text/javascript" src=".//js/jquery.parsequery.min.js"></script>
  <script type="text/javascript" src=".//js/jquery.doubletap-0.1.js"></script>
  <script type="text/javascript" src=".//js/jquery.tipsy.js"></script>

  <script type="text/javascript" src=".//js/fg.menu.js"></script>
  <script type="text/javascript" src=".//js/showoff.js"></script>
  <script type="text/javascript" src=".//js/jTypeWriter.js"> </script>
  <script type="text/javascript" src=".//js/sh_main.min.js"></script>
  <script type="text/javascript" src=".//js/core.js"></script>
  <script type="text/javascript" src=".//js/showoffcore.js"></script>
  <script type="text/javascript" src=".//js/coffee-script.js"></script>

  
    
  

  
    
    <link rel="stylesheet" href=".//file/netways.css" type="text/css"/>
  

  

  <script type="text/javascript">
    $(function(){
      setupPreso(false, './');
    });

    editUrl  = "";
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>
<a tabindex="1" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="stylemenu"><span class="ui-icon ui-icon-triangle-1-s"></span>styles</a>
<div id="stylepicker" class="hidden"></div>


<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">b</td><td>blank screen</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">g</td><td>toggle follow</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
    <tr><td class="key">P</td><td>toggle pause</td></tr>
    <tr><td class="key">s</td><td>choose style</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso"><center>loading presentation...</center></div>
<div id="footer">
  <span id="followMode"></span>
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
  <span id="slideFilename"></span>
  <img id="disconnected" src=".//css/disconnected.png" />
</div>

<div id="slides" class="offscreen" style="display:none;">
<div id="global_Pre_Title_01_Title" class="slide noprint" data-transition="none">
<div class="content noprint" ref="global/Pre/Title/01_Title/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<div class="title-name"><p>Fundamentals for Puppet</p></div>

<div class="title-location"><p>created by NETWAYS GmbH</p></div>

<div class="title-author"><p>Original Author: Dirk GÃ¶tz, Lennart Betz</p></div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="global_Pre_Training_01_Netways" class="slide noprint" data-transition="none">
<div class="content noprint" ref="global/Pre/Training/01_Netways">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Author</h1>

<p>Provided by: </p>

<p><img src="./file/global/Pre/Training/../../_images/netways-logo-1366.png" width="3045" height="589" style="max-width:400px; max-height: 200px; width: auto; height: auto; margin-left: 50px" alt="NETWAYS Logo"></p>

<p><a href="https://www.netways.de">www.netways.de</a> - <a href="https://github.com/NETWAYS">github.com/NETWAYS</a> - <a href="https://twitter.com/netways">@netways</a></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="global_Pre_Training_02_Forthcoming_Training" class="slide center noprint" data-transition="none">
<div class="content center noprint" ref="global/Pre/Training/02_Forthcoming_Training">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Forthcoming Hands-on Training</h1>

<p>For other events and trainings hosted by NETWAYS see our</p>

<p><a href="https://www.netways.de/en/about_netways/events/">event calendar</a></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_training_01_training" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/training/01_training/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>1 Introduction</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_training_01_training" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/training/01_training/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Training</h1>

<p>This training will introduce the basic functionality behind Puppet's abstraction layer, the structure
of Puppet modules and development from local prototype to deployment on Puppet Master. Furthermore
usage of modules provided by the Puppet forge and adding a graphical interface for monitoring the 
infrastructure is covered.</p>

<p>The material is based on Puppet 4.</p>

<div class="handouts">

<hr>

<p>This training will introduce the basic functionality behind Puppet's abstraction layer, the structure
of Puppet modules and development from local prototype to deployment on Puppet Master. Furthermore
usage of modules provided by the Puppet forge and adding a graphical interface for monitoring the 
infrastructure is covered.</p>

<h2>Puppet Open Source</h2>

<p>This chapter will cover the concept, architecture and functionality behind Puppet and Facter. It will
also show the difference between the Open Source and Enterprise version.</p>

<div class="break">continued...</div>

<h2>Modules and Classes</h2>

<p>In this chapter the basic ressource types are introduced and language constructs like dependencies,
resource defaults, variables and variable types and programmatic constructs. These resource type will
be combined to classes and modules which will be used in the common roles-profiles-pattern.</p>

<h2>Puppet Master</h2>

<p>Last but not least we will focus on the Puppet Master. The modules developed will be deployed on it using
git, assigned to nodes and parameterized using hiera. Difference between the Puppet Master and Puppet
Server will be shown before modules provided by the Puppet forge will be used to extend it with the
PuppetDB as reporting backend and Puppet Explorer as graphical interface.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_training_02_hints" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/training/02_hints">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Training Hints</h1>

<ul>
<li>Ask questions! Dumb questions do not exist.</li>
<li>Add your own notes! Having learnt something is reflected best with your own additions.</li>
<li>Join the conversation! Many of these exercises require real world scenarios and your feedback and questions.</li>
<li><p>Work together! Be part of the training team and find solutions together.</p></li>
<li><p>Additional documentation in your browser at <a href="https://docs.puppet.com/puppet/">https://docs.puppet.com/puppet/</a></p></li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_training_03_enviroment" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/training/03_enviroment/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Training Environment</h1>

<div style="text-align: center"><img src="./file/sections/training/./_images/training_environment.png" width="906" height="441" style="float: left; width: 800px; height: 375px;" alt="Training Environment"></div>

<div class="notes">

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_00_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/basics/00_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>2 Basics</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_01_configurationmanagent" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/01_configurationmanagent/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Configuration management</h1>

<ul>
<li>Definition:</li>
</ul>

<p><em>Configuration management is a systems engineering process for establishing and maintaining consistency of a
product performance, functional, and physical attributes with its requirements, design and operational
information throughout its life.</em></p>

<div class="handouts">

<hr>

<p>Wikipedia defines configuration management as a <em>systems engineering process for establishing and maintaining consistency of a
product's performance, functional, and physical attributes with its requirements, design and operational information throughout
its life.</em></p>

<p>So configuration management software is used to describe a desired state, configure a system to be in this state and recognize
drifts from this state to revert them.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_01_configurationmanagent" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/01_configurationmanagent/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Legacy configuration management</h1>

<ul>
<li>Manual configuration</li>
<li>Golden images</li>
<li>Custom one-off scripts</li>
<li>Software packages</li>
</ul>

<div class="handouts">

<hr>

<p>There has always been some type of configuration management but all solutions not designed for it have some shortcomes.</p>

<h2>Manual configuration</h2>

<p>This approach means literally to log in manually in every system and repeat the same configuration change which will
not scale and realistically always create some drift.</p>

<div class="break">continued...</div>

<h2>Golden images</h2>

<p>Using one template to create a new node will result in a consistent installation but keeping this consistency over different
versions of this image is difficult. Difficulty will grow with the number of images need for different environments, projects,
tools and roles.</p>

<h2>Custom one-off scripts</h2>

<p>Script written to solve one problem will be difficult to reuse for other requirements. Also rerunning the same script could be
difficult because of changed conditions. Maintenance typically only done by the original author will prevent further improvments.</p>

<h2>Software packages</h2>

<p>Requires all resources to be managed in this way which makes small changes much more work intensive and slower.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_02_puppet" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/02_puppet/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet's model based approach</h1>

<p>Describe the desired state and let Puppet enforce it</p>

<ol>
<li>
<strong>Describe</strong> your infrastructure and its desired state</li>
<li>
<strong>Simulate</strong> the enforcement of the defined resources</li>
<li>
<strong>Enforce</strong> the desired state of your infrastructure</li>
<li>
<strong>Report</strong> on the state of enforcement</li>
</ol>

<div class="handouts">

<hr>

<ol>
<li>Describe your infrastructure and its desired state

<ul>
<li>Use Puppet to describe the resource and their attributes. Puppet allows you to manage as much or little as you like
and let you grow coverage of the configuration management.</li>
</ul>
</li>
<li>Simulate the enforcement of the defined resources

<ul>
<li>Simulation of the configuration changes allows to verify it and understand the impact before enforcing it.</li>
</ul>
</li>
<li>Enforce the desired state of your infrastructure

<ul>
<li>Each node is brought to the desired state periodically to be compliant and maintain consistency.</li>
</ul>
</li>
<li>Report on the state of enforcement

<ul>
<li>Reports can be send or visualized in many different ways containing all information about agent runs.</li>
</ul>
</li>
</ol>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_02_puppet" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/02_puppet/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet's composable configuration</h1>

<p>Build configuration from small components</p>

<ol>
<li>Declare resources as modules</li>
<li>Assign configuration modules to nodes</li>
<li>Reusable and composable configuration</li>
</ol>

<div class="handouts">

<hr>

<p>The domain specific language of Puppet allows to specify and manage your infrastructure with defined models instead of
procedures. With this DSL complete services and applications can be modelled in a reusable and composable way which 
supports multiple plattforms. Because of the central management you can make changes once and then test and deploy them
in a consistent fashion to multiple nodes.</p>

<p>Puppet (the company behind Puppet formerly Puppet Labs) hosts the Puppet Forge which contains thousands of freely
downloadable modules for resources, applications and services managed by the community: 
<a href="http://forge.puppet.com">http://forge.puppet.com</a></p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_03_installation" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/03_installation/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Repository - RHEL / Centos / Fedora</h1>

<ul>
<li>Puppet 4

<ul>
<li>Puppet Collection - all-in-one package for ease of usage - provided by Puppet</li>
<li>Default Repository - packages according packaging guidelines - Fedora only</li>
</ul>
</li>
<li>Puppet 3

<ul>
<li>Puppetlabs Repository - latest packages - provided by Puppet</li>
<li>EPEL Repository - more stable version - provided by Fedora</li>
<li>Separate RHEL Channel - for use with Satellite 6 - provided by Red Hat</li>
</ul>
</li>
<li>Puppet Enterprise similar to Puppet Collection</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_03_installation" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/03_installation/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Repository - Debian / Ubuntu</h1>

<ul>
<li>Puppet 4

<ul>
<li>Puppet Collection - all-in-one package for ease of usage - provided by Puppet</li>
</ul>
</li>
<li>Puppet 3

<ul>
<li>Puppetlabs Repository - latest packages - provided by Puppet</li>
<li>Default Repository - more stable version - provided by distribution</li>
</ul>
</li>
<li>Puppet Enterprise similar to Puppet Collection</li>
</ul>

<div class="handouts">

<hr>

<p>As you can see there are many different ways to get Puppet installed on your system.</p>

<p>The Puppet Collection provides you with tested and complementary versions of all the tools required for running
Puppet 4 in one entire package provided by the vendor. But this also includes an additional version of openssl for example
which has to be considered individually from the one included in your operating system when dealing with the system security
in mind.</p>

<p>The same goes for Puppet Enterprise which is very similar but requires a subscription and in exchange provides support
the vendor.</p>

<div class="break">continued...</div>

<p>Puppet 4 is only included in the default repository by Fedora for now, all other distributions still include Puppet 3.</p>

<p>If the version of Puppet 3 included in your preferred distribution is older than the one you are required to run you
can also switch to the repository provided by Puppet for Puppet 3 which will included the latest version. These packages
are not all-in-one packages instead they depend on the operating system libraries and tools.</p>

<p>In this training we will use the Puppet Collection because we want to demonstrate the new features. This is no recommendation
for the all-in-one packaging format! For your environment decide on your own which package maintainer to trust and which version
is required for your tool stack and which best suits your needs.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_03_installation" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/03_installation/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet Enterprise</h1>

<ul>
<li>Packaging for additional plattforms including additional components</li>
<li>Puppet Enterprise Console as Webinterface</li>
<li>Additional Components

<ul>
<li>Puppet Node Manager - group nodes on facts</li>
<li>Puppet Code Manager - combines r10k, Jenkins and beaker for testing and deploying code</li>
<li>Puppet Configuration Manager - helps troubleshoot dependencies</li>
</ul>
</li>
<li>Supported Modules</li>
<li>Automated Provisioning for some plattforms</li>
<li>Vendor support and service</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet itself is completly Open Source, but the Enterprise version adds to this Open Source tool.</p>

<p>Open Source Packages are widely available, but some plattforms have a limited community so getting packages for example
on AIX is difficult where Puppet Enterprise provides their complete toolstack for all plattforms they support in the same
fashion. Also Puppet Enterprise Console adds an Webinterface for assigning configuration and view reports, but there are
alternate frontend like Puppet Explorer or Foreman. </p>

<div class="break">continued...</div>

<p>For the additional components not always is an alternative available but some
can be build from the same components used in Puppet Enterprise and none of it is required. Puppet Support also includes
support for specific modules but is also limited to those and does not cover your own code. Also they cooporate with other
vendors to create solutions for automated provisioning on their plattform, but Foreman is more powerfull and supports more
plattforms. So vendor support is only available for the Enterprise version, while Open Source support is available from
different sources covering sometimes more or at least other components.</p>

<p>At the end it is your choice if you want to use Puppet Enterprise and can take some benefit of the commercial version or
if you use the Open Source version and add components you require and perhaps buy a support contract from a third party.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_03_installation" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/03_installation/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 2.1: Installation</h1>

<ul>
<li>Objective:

<ul>
<li>Install package <code>puppet-agent</code> in the same version as the master runs.</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Make Puppet Collection available.</li>
<li>Inspect what version is installed on your master.</li>
<li>Install puppet-agent in the inspected version.</li>
<li>Extend your path variable to include the puppet command.</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_basics_04_facter" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/basics/04_facter">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Facter</h1>

<ul>
<li>Facter returns key value pairs named facts</li>
<li>It is used by Puppet to gather information about the node</li>
<li>
<p>You can also run it on command line to list facts</p>

<pre>
augeas =&gt; {
  version =&gt; "1.4.0"
}
disks =&gt; {
  vda =&gt; {
    size =&gt; "10.00 GiB",
    size_bytes =&gt; 10737418240,
    vendor =&gt; "0x1af4"
  }
}
...
system_uptime =&gt; {
  days =&gt; 0,
  hours =&gt; 2,
  seconds =&gt; 8378,
  uptime =&gt; "2:19 hours"
}
timezone =&gt; UTC
virtual =&gt; kvm
</pre>
</li>
</ul>

<div class="handouts">

<hr>

<div class="break">continued...</div>

<p>Facter returns key value pairs named facts. In older versions these were simple string representations, newer versions
also structured facts are possible which means a array or hash is returned. </p>

<p>The facts are used as Puppet's inventory tool and are generated before requesting a catalog from the master. The master
can use facts in conditionals or templates during catalog compilation but it is impossible to change its values during
a run or change the agents behaviour directly on the node based on facts.</p>

<p>Facter includes many different built-in facts and allows to add additional facts in several ways which allows to provide
them by Puppet modules requiring this information.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_00_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/ral/00_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>3 Resource Abstraction Layer</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_01_concept" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/01_concept">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet Concept</h1>

<ul>
<li>Puppet is about abstraction</li>
<li>Domain Specific Language allows for an abstract description of resources

<ul>
<li>Infrastructure as Code</li>
<li>Executable Documentation</li>
</ul>
</li>
<li>Define the desired state and not how to get there 

<ul>
<li>Idempotence</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet is all about abstraction. It defines its own Domain Specific Language which allows
for an abstract description of resources. This tries to be as human readable as possible
so typically getting a basic understanding of Puppet code is possible without further 
knowledge in Puppet because of this it is often referenced as "Executable Documentation".
Another term often used is "Infrastructure as Code" referring to code being always the best
documentation and Puppet code can manage the complete infrastructure.</p>

<p>A terminology from mathematics or computer science called "Idempotence" is also often used
meaning for Puppet that Puppet Code can be applied multiple times without further changing
the result beyond the initial application. This is done by only defining the desired state
and Puppet will determine internally how to get to this state. </p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_02_workflow" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/ral/02_workflow/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet Workflow</h1>

<p></p>
<center><img src="./file/sections/ral/./_images/puppet_workflow.png" width="546" height="456" style="width:516px;height:456px;" alt="Workflow"></center>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_03_toolstack" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/03_toolstack/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet master</h1>

<ul>
<li>The master runs on a central server</li>
<li>Includes a Certificate authority</li>
<li>Authenticates agent connections</li>
<li>Serves a compiled catalog with the desired configuration state on agent request</li>
<li>Acts as file server</li>
<li>Forwards reports to report handlers</li>
<li>Two different implementations:

<ul>
<li>Puppet Master - Ruby (executed typically with Apache and Passenger)</li>
<li>Puppet Server - jRuby (executed in a JVM)</li>
</ul>
</li>
<li>Supported on most Linux distributions</li>
</ul>

<div class="handouts">

<hr>

<div class="break">continued...</div>

<p>Puppet runs on a central server as master which includes a internal certificate authority.
These certificates are distributed to the agents so the master can authenticate their connections and
then serve a compiled catalog with the desired configuration state on request. If managing static
files the master also acts as file server. If configured to do so the master takes reports from the
agents and forwards them to report handlers like sending them via mail or uploading them to a frontend
like the Puppet Explorer.</p>

<p>The Puppet master exists in two different implementations. The longer existing version is vanilla Ruby
which can be run with Ruby's own webserver or any webserver supporting executing of Ruby code but is 
typically run with Apache and Passenger. The newer alternative is Puppet Server which is jRuby executed
in a JVM as the vendor's approach on increasing the performance. More on the differences later on.</p>

<p>Running Puppet in master mode is supported on most Linux distributions.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_03_toolstack" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/03_toolstack/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet agent</h1>

<ul>
<li>Agent runs as service on all managed nodes</li>
<li>Requests periodically the desired configuration state from the Puppet master</li>
<li>Sends information about itself to determine the configuration state (facts)</li>
<li>Enforces the retrieved configuration state (catalog)</li>
<li>Report enforcement back to master</li>
<li>Supported plattforms:

<ul>
<li>most Linux distributions</li>
<li>Windows</li>
<li>many Unix distributions</li>
<li>Mac OS X</li>
<li>some Network devices</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>The Puppet agent runs as service on all managed nodes and requests periodically the desired configuration
state from the Puppet master for this it sends information about itself so called facts to the master so it
can determine the configuration state. The retrieved configuration state as a catalog is then enforced.
Configuration changes and metrics are then reported back to the master.</p>

<div class="break">continued...</div>

<p>The agent is supported on most Linux distributions, Windows, Solaris, HP-UX, AIX, Mac OS X and some Network
devices.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_04_apply" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/04_apply">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet apply</h1>

<ul>
<li>The Puppet apply command combines master and agent functionality

<ul>
<li>Takes a file containing Puppet code</li>
<li>Gathers information using facter</li>
<li>Compiles a catalog</li>
<li>Enforces the configuration</li>
<li>Can also run in simulation mode</li>
</ul>
</li>
<li>Useful for development and local testing or master-less setups</li>
<li>Requires root privileges</li>
</ul>

<div class="handouts">

<hr>

<p>The Puppet apply command combines master and agent functionality which is useful for development
and local testing or master-less setups. </p>

<p>It takes a file containing Puppet code as input, then gathers information about the system using
facter to compile a catalog and last but not least enforces the configuration. It can also run in
simulation mode which only notifies about required changes instead of enforcing it.</p>

<p>To reduce complexity for now we will start developing Puppet code and use apply to test it and only
move later to a master agent setup.</p>

<p>Running the puppet commands as unprivileged user works as long as you only manage resources the
unprivileged users can access. So typically it will require root privileges because you want to
manage packages, users and so on only root is allowed to manage.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_05_example" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/05_example/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Example <u>managing user</u>
</h1>

<ul>
<li>Managing a user without Puppet means managing:

<ul>
<li>Existence of user and attributes</li>
<li>Group membership</li>
<li>Home directory </li>
</ul>
</li>
<li>Requires knowledge of:

<ul>
<li>Installed tool (<em>useradd</em> or <em>adduser</em>)</li>
<li>Options of those tools (<em>-g</em> or <em>-G</em>)</li>
<li>Creating, changing, deleting requires different tools (<em>useradd</em>, <em>usermod</em>, <em>userdel</em>)</li>
</ul>
</li>
<li>Challenges for automation:

<ul>
<li>Scripting</li>
<li>Error handling and logging</li>
<li>Multiple plattforms</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Managing a user without Puppet means managing the existence of the user and its attributes,
managing groups required for group membership and existence and permissions of the home directory.</p>

<div class="break">continued...</div>

<p>This task is quite simple but requires to know which tools you will reliable find on your systems.
Some distributions install <em>useradd</em>, others <em>adduser</em> for creating a user. Then you have to know
the options to provide, e.g. what was the difference of <em>-g</em> and <em>-G</em>, which can get more complicated
if using multiple systems, e.g. modifying additional group membership <em>-a -G newgroup</em> works on RHEL,
<em>-A newgroup</em> on SLES and on AIX you have to provide a list of all groups to <em>-G</em>. Also managing a
user between different states will require different tools like <em>useradd</em> for creation, <em>usermod</em> for
changes on existing users and <em>userder</em> for deletion.</p>

<p>This will all increase the challenge of automation of user management. It has to be scripted in a
readable and maintainable way including error handling and logging. If your goal is the support of
multiple plattforms it increases complexity and limits options.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_05_example" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/05_example/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Example <u>managing user</u>
</h1>

<ul>
<li>
<p>The same task with Puppet</p>

<ul>
<li>Describe the user</li>
<li>Enforce with Puppet</li>
</ul>

<pre>
user { 'icinga':
  ensure     =&gt; present,
  gid        =&gt; 'icinga',
  groups     =&gt; ['icingacmd'],
  home       =&gt; '/var/spool/icinga',
  shell      =&gt; '/sbin/nologin',
  managehome =&gt; true,
}
</pre>
</li>
</ul>

<div class="handouts">

<hr>

<p>The same task is very easy with Puppet. You only have to describe the user in Puppet Domain Specific Language
and the run Puppet to enforce it. Puppet will create the user if it does not exist and make adjustments if the
user exists like attributes which do not match the desired state.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_06_basics" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/06_basics/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Resource Abstraction Layer</h1>

<ul>
<li>Puppet uses a Resource Abstraction Layer

<ul>
<li>Groups similar resources into resource types</li>
<li>Resource types have multiple providers</li>
</ul>
</li>
<li>Resources can be declared always in the same fashion</li>
<li>A resource will be managed by the best matching provider on the plattform</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_06_basics" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/ral/06_basics/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Resource Abstraction Layer</h1>

<p></p>
<center><img src="./file/sections/ral/./_images/resource_abstraction_layer.png" width="702" height="460" style="width:702px;height:460px;" alt="Resource Abstraction Layer"></center>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_06_basics" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/06_basics/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Providers</h1>

<ul>
<li>Availability of a provider is determinated by testing for availability of required binaries</li>
<li>Can be marked as default for specific facts (typically operatingsystem)</li>
<li>Can support all or only a subset of features a resource type requires</li>
<li>Example for resource <strong>package</strong>

<ul>
<li>Providers:
<pre>
aix appdmg apple apt aptitude aptrpm blastwave dnf dpkg fink freebsd
gem hpux macports nim openbsd opkg pacman pip3 pip pkg pkgdmg pkgin
pkgng pkgutil portage ports portupgrade puppet_gem rpm rug sun
sunfreeware up2date urpmi windows yum zypper
</pre>
</li>
<li>Features:
<pre>
holdable install_options installable package_settings purgeable reinstallable
uninstall_options uninstallable upgradeable versionable virtual_packages
</pre>
</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<div class="break">continued...</div>

<p>Puppet decides which provider is available by testing for required binaries. Afterwards it will lookup if
the providers support all the features required for the desired configuration. If still multiple providers
fit it will use the one marked as default for a specific set of facts which is typically the operatingsystem
or osfamily, sometimes in relation to the release version.</p>

<p>So for example to manage a package resource on CentOS it will find <u>rpm</u> and <u>yum</u> and perhaps some like <u>gem</u>
for ruby or <u>pip</u> for python. If now a operating system package should be installed <u>rpm</u> and <u>yum</u> can solve
this task, but <u>yum</u> will be used because it is default for <u>osfamily redhat</u>. If a package should be purged
only <u>yum</u> would match because <u>rpm</u> does not provide this feature.</p>

<p>For more details have a look at the resource type reference in the documentation: 
<a href="https://docs.puppet.com/puppet/latest/reference/type.html">https://docs.puppet.com/puppet/latest/reference/type.html</a> </p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_07_command" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/07_command/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet Resource Command</h1>

<ul>
<li>Puppet provides a command to directly interact with the Resource Abstraction Layer</li>
<li>Querying all or one resource of a type returns Puppet code representation of current state</li>
<li>
<p>Setting attributes will change state using available provider</p>

<pre>
# puppet resource package vim-enhanced
package { 'vim-enhanced':
  ensure =&gt; 'purged',
}

# puppet resource package vim-enhanced ensure=present
Notice: /Package[vim-enhanced]/ensure: created
package { 'vim-enhanced':
  ensure =&gt; '7.4.160-1.el7',
}
</pre>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet provides a command to directly interact with the Resource Abstraction Layer. <code>puppet resource</code> can be
used to query all or one resource of a specified type which will return current state represented as Puppet
code. It furthermore allows to set attributes to a desired state and then Resource Abstraction Layer will
find an available provider to enforce the state.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_ral_07_command" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/ral/07_command/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 3.1: Puppet Resource</h1>

<ul>
<li>Objective:

<ul>
<li>Use Puppet Resource Command to query and change resources</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Query all users</li>
<li>Query state of the file "/etc/passwd"</li>
<li>Ensure package "vim-enhanced" is installed</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_01_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/resources/01_overview/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>4 Resources</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_01_overview" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/01_overview/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Resources</h1>

<ul>
<li>Puppet includes in its installation some core resource types, for example:

<ul>
<li>user</li>
<li>group</li>
<li>file</li>
<li>package</li>
<li>service</li>
</ul>
</li>
<li>Additional ones can be provided by modules, for example:

<ul>
<li>file_line</li>
<li>ini_setting</li>
<li>mysql_database</li>
<li>vcsrepo</li>
</ul>
</li>
<li>A list can be generated by with the puppet describe command</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet includes in its installation some core resource types. Most of those are realy basic
types like user, group, file, package or service, but some are very specific like the Nagios
objects or Solaris zones, zfs and zpool.</p>

<div class="break">continued...</div>

<p>Additional ones can be provided by modules like file_line from puppetlabs/stdlib, ini_setting
from puppetlabs/inifile, mysql_database from puppetlabs/mysql and vcsrepo from puppetlabs/vcsrepo.</p>

<p>A list of all known resource types can be generated by with the <code>puppet describe</code> command:</p>

<pre><code> # puppet describe --list
</code></pre>

<p>Documentation of a resource type can be displayed with this command, too. Append the parameter <code>-s</code>
to only get a summarized version.</p>

<pre><code> # puppet describe &lt;type&gt; [-s]
 # puppet describe user -s
</code></pre>

<p>To render the documentation in some other format use the <code>puppet doc</code> command like:</p>

<pre><code> # puppet doc -r type
</code></pre>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_02_syntax" class="slide small smbullets" data-transition="none">
<div class="content small smbullets" ref="sections/resources/02_syntax">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Syntax and Style</h1>

<p>Puppet is as much about syntax as about style</p>

<pre>
type { 'title':
  ensure            =&gt; present,
  attribute         =&gt; 'value',
  other_attribute   =&gt; $variable,
  another_attribute =&gt; "${another_var}.txt",
}
</pre>

<pre>
file { '/tmp/test':
  ensure  =&gt; file,
  owner   =&gt; 'root',
  group   =&gt; 'root',
  mode    =&gt; $file_mode,
  content =&gt; "Hello, ${user}!",
}
</pre>

<div class="handouts">

<hr>

<p>Above you can see the basic syntax of a resource in Puppet. First one shows the general schema, second one a example
for a file resource.</p>

<p>The <u>type</u> defines which type of resource is managed, e.g. a <u>file</u> resource, this defines the allowed attributes.
The resource definition is then put in curly brackets. The <u>title</u> is important for naming the resource and is used
to ensure uniqueness. As a simple string the <u>title</u> is put in single quotes. The <u>title</u> is always follow by a colon.
A list of attribute value pairs follows next, always indented by two whitespaces (by style guide) and separated by an
arrow (which should be aligned by style guide). </p>

<div class="break">continued...</div>

<p>There is no particular order required, but if an attribute <u>ensure</u>
exists it should be the first, so a reader can easily recognize if a resource is created or removed. The value of the 
attribute should be quoted in single quotes if it is a simple string or in doublequotes if it includes a variable. No
quoting is used for variables or barewords like the state of <u>ensure</u> or a boolean. Resource attributes must have a
trailing comma, including the last one which is again only by style guide and not required by syntax.</p>

<p>Every resource has a so called namevar attribute if not explicitly set the title will be used for its value. In most cases
it is simply the name attribute, but the file resource for example uses the path attribute as namevar.</p>

<p>So the basic syntax is very simple, but Puppet is as much about syntax as about style because it is intended to be
easily readable. Because of this the vendor provides a style guide: <a href="https://docs.puppet.com/guides/style_guide.html">https://docs.puppet.com/guides/style_guide.html</a></p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_03_users_groups" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/03_users_groups/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.1: User</h1>

<ul>
<li>Objective:

<ul>
<li>Create yourself a user</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a manifest to manage your user</li>
<li>Declare your personal user including its shell</li>
<li>Set it to also manage your home directory</li>
<li>Apply the manifest</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet's user management is primary designed for managing system users
or a small amount of administrative users. User management is still done
best by central authentication services like ldap and kerberos.</p>

<p>The file extension for files containing Puppet code is .pp, those files
are called manifests. A syntax validaten for this files can be done with
"puppet parser validate".</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_03_users_groups" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/03_users_groups/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.2: Group</h1>

<ul>
<li>Objective:

<ul>
<li>Manage the group membership of your user</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Add a group definition for your user's private group to your manifest</li>
<li>Add a group definition for a administrative group to your manifest</li>
<li>Change your user definition to set its private group as its primary group and the administrative group as secondary</li>
<li>Apply the manifest</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>The user attribute <u>groups</u> is an array. Puppet uses the same notation for array like ruby, a comma separated list of
elements in square brackets.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_03_users_groups" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/03_users_groups/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.3: SSH Authorized Key</h1>

<ul>
<li>Objective:

<ul>
<li>Grant your user access to the system authenticated by a ssh key</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Generate a ssh key on your laptop</li>
<li>Add a ssh_authorized_key resource to distribute your public key</li>
<li>Apply the manifest</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Make sure to use the proper attributes of the ssh_authorized_key resource. Type, key and comment are separated!</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_03_users_groups" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/03_users_groups/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.4: Sudoers</h1>

<ul>
<li>Objective:

<ul>
<li>Grant your user administrative privileges using sudo</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Ensure package "sudo" is installed</li>
<li>Manage a file in "/etc/sudoers.d" for your user allow to execute all commands as root</li>
<li>Apply the manifest</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>File permissions on files on "/etc/sudoers.d" is as important as syntax. Make sure to have a session as
"root" open before doing any changes because you can deny access via sudo at all by failures.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Ordering</h1>

<ul>
<li>Default order depends on order of declaration and implicit dependencies</li>
<li>Ordering can be changed to:

<ul>
<li>Hash based ordering which was default in older versions</li>
<li>Random ordering to ensure all necessary dependencies are declared</li>
</ul>
</li>
<li>Dependencies can be set explicitly</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet 4 applies unrelated resources in the order of declaration only taking implicit
dependencies into account. The default ordering before Puppet 4 was hash based which
was random but predictable accross agent runs and systems. The configuration also allows
to set it explicitly to random which always randomizes the order of unrelated resources
on every run. This mode is helpful to find necessary dependencies which are not declared
explicitly.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/resources/04_ordering_relationship/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Implicit Dependencies</h1>

<p><img src="./file/sections/resources/./_images/implicit_dependencies.png" width="829" height="510" style="float: center; margin-left: 50px; width: 800px; height: 492px;" alt="Implicit Dependencies"></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/resources/04_ordering_relationship/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Implicit Dependencies - User</h1>

<p><img src="./file/sections/resources/./_images/implicit_dependencies_user.png" width="714" height="400" style="float: center; margin-left: 50px; width: 800px; height: 448px;" alt="Implicit Dependencies - User"></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/resources/04_ordering_relationship/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Implicit Dependencies - Exec</h1>

<p><img src="./file/sections/resources/./_images/implicit_dependencies_exec.png" width="764" height="400" style="float: center; margin-left: 50px; width: 800px; height: 419px;" alt="Implicit Dependencies - Exec"></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Explicit Dependencies</h1>

<ul>
<li>4 types of relationship</li>
<li>Defined by metaparameter of all resources</li>
<li>Simple Ordering:

<ul>
<li>
<em>require</em> - referenced resource will be applied first</li>
<li>
<em>before</em> - apply this resource before the reference</li>
</ul>
</li>
<li>Refresh Events:

<ul>
<li>
<em>subscribe</em> - if reference is changed refresh this resource</li>
<li>
<em>notify</em> - if this resource is changed refresh the reference</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Explicit Dependencies can be defined in four different ways by adding the corresponding metaparameter.
This metaparameter attributes exist for all resources.</p>

<p>Syntax examples will be shown on the next pages.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/resources/04_ordering_relationship/6">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Explicit Dependencies - Ordering</h1>

<p><img src="./file/sections/resources/./_images/explicit_dependencies_ordering.png" width="1410" height="530" style="float: center; margin-left: 50px; width: 800px; height: 300px;" alt="Explicit Dependencies - Ordering"></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/resources/04_ordering_relationship/7">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Explicit Dependencies - Refresh</h1>

<p><img src="./file/sections/resources/./_images/explicit_dependencies_refresh.png" width="1460" height="530" style="float: center; margin-left: 50px; width: 800px; height: 300px;" alt="Explicit Dependencies - Refresh"></p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/8">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Reference Syntax</h1>

<p>Allows to reference other managed resources</p>

<pre>
Type['title']
</pre>

<pre>
Service['sshd']
</pre>

<div class="handouts">

<hr>

<p>Another new syntax was introduced in the example for dependencies: the reference of a resource.</p>

<p>The syntax schema is the resource type as uppercase and the title in square brackets for example
<code>Service['sshd']</code>.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/9">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Dependency Chains</h1>

<ul>
<li>Alternative syntax for explicit dependency</li>
<li>Works great with references</li>
<li>Simple Ordering:

<ul>
<li>
<em>before</em>: Package['openssh-server'] <strong>-&gt;</strong> File['sshd_config']</li>
<li>
<em>require</em>: Package['openssh-server'] <strong>&lt;-</strong> File['sshd_config']</li>
</ul>
</li>
<li>Refresh Events:

<ul>
<li>
<em>notify</em>: File['sshd_config'] <strong>~&gt;</strong> Service['sshd']</li>
<li>
<em>subscribe</em>: File['sshd_config'] <strong>&lt;~</strong> Service['sshd']</li>
</ul>
</li>
<li>For readability use <em>before</em> (<strong>-&gt;</strong>) and <em>notify</em> (<strong>~&gt;</strong>)!</li>
</ul>

<div class="handouts">

<hr>

<p>The chaining arrow syntax is an alternative syntax for explicit dependencies which works great
with references. According to the style guide you should prefer the metaparameters but in case
of interdependent or order-specific items it is quite helpful.</p>

<p>In these cases using the references to declare the dependencies outside of the declaration of
resources increases the readability and also allows to change ordering depending on parameters.</p>

<p>Also if both directions exist you should avoid the arrows pointing backwards because of readability
and stick to those pointing left to right.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/10">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.5: Package-File-Service Pattern</h1>

<ul>
<li>Objective:

<ul>
<li>Install and run the Apache webserver</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Ensure package "httpd" is installed</li>
<li>Manage its configuration file "/etc/httpd/conf/httpd.conf"</li>
<li>Enable and start the service "httpd"</li>
<li>Add dependencies to make sure it is installed before you configure it and config changes restart the service</li>
<li>Apply the manifest</li>
<li>Add the "Servername" to the configuration and apply again</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>This design of Puppet code is known as Package-File-Service pattern. If a service depends on multiple files
they are typically grouped in a separate class and dependencies are enforced on this level. We will do this
later after introducing the concept of classes.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/11">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Exec Resource</h1>

<ul>
<li>Resource to execute commands</li>
<li>Avoid if possible</li>
<li>If required use an attribute for idempotence

<ul>
<li>creates</li>
<li>onlyif / unless</li>
<li>refreshonly</li>
</ul>
</li>
<li>
<p>Use full path or provide path as attribute</p>

<p>exec { 'command':
  path        =&gt; '/usr/sbin/:/sbin/',
  refreshonly =&gt; true,
  timeout     =&gt; 60,
}</p>
</li>
</ul>

<div class="handouts">

<hr>

<p>The exec resource is used to execute commands so it should be avoided if possible.</p>

<p>If it is required use an attribute to ensure idempotence. The "creates" attribute points to a file which is created by the
command and the command will not be executed as long as the file exists. "Onlyif" or "unless" can be used to run a script
before the execution of the defined command and depending of their exit code the command will be executed. "Refreshonly"
can be used to execute a command only if it gets a refresh event from another resource.</p>

<p>The command has to be defined with the full path or the attribute "path" has to provide a list seperated by ":" or an array.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_04_ordering_relationship" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/04_ordering_relationship/12">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.6: Exec Resource</h1>

<ul>
<li>Objective:

<ul>
<li>Add an exec resource to change restart behaviour</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Add a exec resource to restart apache</li>
<li>Change the service resource to reload instead of restart</li>
<li>Change the file resource to notify the exec instead of the service</li>
<li>Apply the manifest</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>This adjustment is common for services which loose information during restart but not during reload like Apache loosing sessions.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_05_resource_defaults" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/05_resource_defaults/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Resource Defaults</h1>

<ul>
<li>Puppet allows you to declare resource defaults</li>
</ul>

<pre>
Type {
  attribute =&gt; 'value',
}
</pre>

<pre>
File {
  owner =&gt; 'root',
  group =&gt; 'root',
  mode  =&gt; '0644',
}
</pre>

<ul>
<li>For directories Puppet promotes a mode default of "0644" to "0755"</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet allows you to declare resource defaults to shorten the code and make it more readable.
A resource default is declared like a resource only the resource type is uppercase and there
is no title given.</p>

<p>The example sets default for owner, group and mode of every file resource in the scope it is
declared. Because of being scope wide a resource default should only be declared on the highest
or lowest scope. More on scope when we take about variables.</p>

<p>There is one special case for the file resource. If the type is set to directory Puppet will
automatically promotes a mode default of "0644" to "0755".</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_05_resource_defaults" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/05_resource_defaults/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.7: Resource Defaults</h1>

<ul>
<li>Objective:

<ul>
<li>Add a vhost definition to your webserver</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Set the resource default for file resources to provide owner, group and mode</li>
<li>Add a host entry for your vhost on your server</li>
<li>Add a configuration file for your vhost</li>
<li>Create the document root and an index file</li>
<li>Apply the manifest and restart the service</li>
</ul>
</li>
<li>Optional:

<ul>
<li>Add an additional vhost for your default servername</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>The optional task is necessary because if one vhost exists in Apache's configuration everything has to managed
as vhost, the default configuration will not be used any longer.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_05_resource_defaults" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/05_resource_defaults/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Block based Resource Defaults</h1>

<ul>
<li>Puppet 4 introduced an alternative block based version</li>
</ul>

<pre>
file {
  default:
    mode   =&gt; '0600',
    owner  =&gt; 'root',
    group  =&gt; 'root',
    ensure =&gt; file,
  ;
  '/etc/ssh_host_key':
  ;
  '/etc/ssh_host_dsa_key.pub':
    mode =&gt; '0644',
  ;
}
</pre>

<div class="handouts">

<hr>

<p>Puppet 4 introduced an alternative block based version allowing to set defaults
in a fine granular manor. </p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_06_classes" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/06_classes/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Classes</h1>

<ul>
<li>Classes define a collection of resources</li>
</ul>

<pre>
class ssh {
  package  { 'openssh':
    ensure =&gt; present,
  }

  file { '/etc/ssh/sshd_config':
    ensure  =&gt; file,
    owner   =&gt; 'root',
    group   =&gt; 'root',
    mode    =&gt; '0644',
    require =&gt; Package['openssh'],
  }

  service { 'sshd':
    ensure  =&gt; running,
    enable  =&gt; true,
    require =&gt; File['/etc/ssh/sshd_config'],
  }
}
</pre>

<div class="handouts">

<hr>

<p>In Puppet Classes define a collection of resources. This is used to encapsulate related resources.
A good design is to create small classes only containing related resources grouped in a logic that
allows to be stack together in multiple ways.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_06_classes" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/resources/06_classes/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 4.8: Classes</h1>

<ul>
<li>Objective:

<ul>
<li>Rework your apache manifest to provide a class apache</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Rework your apache manifest to provide a class apache</li>
<li>During apply have a look on what Puppet is actually doing</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_06_classes" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/resources/06_classes/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Defining vs. Declaring</h1>

<ul>
<li>Define:</li>
</ul>

<p>To specify the contents and behavior of a class. Defining a class doesn't automatically 
include it in a configuration; it simply makes it available to be declared.</p>

<ul>
<li>Declare:</li>
</ul>

<p>To direct Puppet to include or instantiate a given class. To declare classes, use the include
function. This tells Puppet to evaluate the class and manage all the resources declared within it.</p>

<div class="handouts">

<hr>

<p>Puppet differentiates between defining and declaring a class. With the class syntax we only
defined it, to also declare it we could use the include or contain function or declare it
in the same syntax like other resources. The difference between these options will be shown
later.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_06_classes" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/resources/06_classes/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Declaring Classes</h1>

<ul>
<li>with <code>include</code> Funktion
<pre>
include apache
</pre>
</li>
<li>like any other resources
<pre>
class { 'apache': }
</pre>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_resources_06_classes" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/resources/06_classes/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Idempotency of include</h1>

<ul>
<li>The function <code>include</code> is idempotence. That mean you can use the include of the same class several times in your code.
<pre>
include apache
include apache
</pre>
</li>
<li>The class is declared just once, the first time it was used.</li>
<li>Notice: A mix between the declaration with include and class doesn't work and pass to a doublicate declaration error. </li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_01_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/code_logic/01_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>5 Code Logic</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_02_variables" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/02_variables/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Variables</h1>

<ul>
<li>Syntax
<pre>
$variable = 'value'
</pre>
<pre>
$httpd_confdir = '/etc/httpd/conf.d'
</pre>
</li>
<li>Can be used in expressions, functions and resource attributes</li>
<li>Some naming conventions enforced, some keywords reserved</li>
<li>Depending on scope</li>
<li>Different data types</li>
<li>Actually are <u>constants</u>!</li>
</ul>

<div class="handouts">

<hr>

<p>In Puppet variables are prefixed with '$' and can be used in expressions, functions and resource attributes
including the title. In variable names only uppercase and lowercase letters, numbers and underscores are allowed.
The names have to start with lowercase letter or underscore indicating internal use only. Also the style guide
does not allow uppercase letters for inconsistency in style.</p>

<div class="break">continued...</div>

<p>They have to be defined before using them and this definition depends on the scope also Puppet 4 introduced
an optional data type system for some specific use cases. In older versions all data types were simply handled
internally and converted automatically if possible. More on scope and data types on the next pages.</p>

<p>One very important thing about variables in Puppet to know is that they are actually constants as you can not
reassign values.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_02_variables" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/code_logic/02_variables/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Scope</h1>

<p></p>
<center><img src="./file/sections/code_logic/./_images/scope-euler-diagram.png" width="635" height="459" style="width: 687px; height: 560px;" alt="Scope"></center>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_02_variables" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/02_variables/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Accessing Variables in a specific scope</h1>

<ul>
<li>Shortname accesses Local Scope

<ul>
<li>Static scope in Puppet 4</li>
<li>Dynamic scope in older versions
<pre>$httpd_confdir</pre>
</li>
</ul>
</li>
<li>Qualified name accesses scope defined by namespace

<ul>
<li>Top Scope (also contains facts) and Node Scope
<pre>$::osfamily</pre>
</li>
<li>Out-of-Scope
<pre>$apache::params::confdir</pre>
</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet allows to access variables in a specific scope. If the shortname of a variable is used it will
be using the value defined in the Local Scope. If the variable is not defined in Local Scope it will
searched in a static scope build on inheritance of the classes, node and top scope. This is much more
predictable then the dynamic scope used in older versions creating a scope graph by inheritance and
declaration.</p>

<p>Facts provided by Facter are available from the Top Scope and can be used like every other variable.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_02_variables" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/02_variables/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Data Types</h1>

<ul>
<li><strong>Completely optional</strong></li>
<li>Simple Data Types

<ul>
<li>Strings</li>
<li>Numbers</li>
<li>Booleans</li>
<li>Arrays</li>
<li>Hashes</li>
<li>Regular Expressions</li>
<li>Undef</li>
<li>Resource References</li>
<li>Default</li>
</ul>
</li>
<li>Abstract Data Types

<ul>
<li>Flexible Data Types</li>
<li>Parent Types</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet 4 introduced a data type system which allows the user to define a variable of a specific data type.
In older versions all data types were simply handled internally and converted automatically if possible,
if you do not specify a data type for a variable in Puppet 4 it will still use this behaviour. These data
types can only be used parameter lists, match expressions, case statements and selector expressions and <strong>not</strong>
for variables.</p>

<div class="break">continued...</div>

<p>There are the typical simple data types like Strings, Numbers, Booleans, Arrays and Hashes and others are more
specific to Puppet. In addition there are abstract data types which can be used to enforce a more specfic
value or allow to validate more flexible without having to deal with something weird.</p>

<p>All details on <a href="https://docs.puppet.com/puppet/latest/reference/lang_data.html">https://docs.puppet.com/puppet/latest/reference/lang_data.html</a></p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_02_variables" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/02_variables/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 5.1: Variables</h1>

<ul>
<li>Objective:

<ul>
<li>Rework your vhost manifest to include variables</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Add variables for hostname, fqdn, ip address of your vhost</li>
<li>Add variables for apache's configuration directory and your vhost's document root</li>
<li>Incorporate the variables in your resource declarations</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Conditionals</h1>

<ul>
<li>Puppet supports four types of conditionals

<ul>
<li>selectors</li>
<li>
<code>case</code> statements</li>
<li>
<code>if</code> statements</li>
<li>
<code>unless</code> statements</li>
</ul>
</li>
<li>Can be used to

<ul>
<li>return values</li>
<li>alter logic</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet supports four types of conditionals.</p>

<p><strong>Selectors</strong> can be used to return values and <strong>case</strong>, <strong>if</strong> or <strong>unless</strong> statements to alter the
logic flow of your manifest.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Selectors</h1>

<ul>
<li>Good for assigning conditional values to variables</li>
</ul>

<pre>
$apache_package = $::osfamily ? {
  'RedHat' =&gt; 'httpd',
  default  =&gt; 'apache2',
}

package { 'apache':
  ensure =&gt; installed,
  name   =&gt; $apache_package,
}
</pre>

<div class="handouts">

<hr>

<p>Selectors are good for assigning conditional values to variables like the example above.</p>

<p>You can use it also in other constructs most time at the expense of readability. One of such cases is
the use as resource attribute.</p>

<pre><code>package { 'apache':
  ensure =&gt; installed,
  name   =&gt; $::osfamily ? { 
    'RedHat' =&gt; 'httpd',
    default  =&gt; 'apache2',
  }
}
</code></pre>

<p>The syntax is the conditional expression followed by the question mark and curly brackets containing
any number of matches. The matches consists of a case, the arrow and a value. It should always include
a default match if you do not explicitly want Puppet to fail in the case no match is found.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Case statement</h1>

<ul>
<li>Ideal for:

<ul>
<li>setting multiple variables at once</li>
<li>choosing different branches of code</li>
</ul>
</li>
</ul>

<pre>
case $::osfamily {
  'RedHat': {
    $apache_package = 'httpd'
    $apache_confdir = '/etc/httpd'
  }
  default: {
    $apache_package = 'apache2'
    $apache_confdir = '/etc/apache2'
  }
}
</pre>

<div class="handouts">

<hr>

<p>The ideal use of case statements is to set multiple variables at once or to choose different branches
of code. In most cases it is more readable then multiple selectors and a complex if or unless statement.</p>

<p>The general form of a case statement starts with the keyword case followed by the control expression and
curly brackets containing matches. The match consists of a case or comma separated list of cases followed
by a colon and some puppet code in curly brackets. The match on strings is case insensitive, so use regular
expressions for case sensitive matches like <em>/<sup>Debian|Ubuntu</sup>$/</em>. Furthermore it is best practice to provide
a valid default if possible, if not use the function <code>fail</code> to fail catalog compilation or include an empty
default for clarityâs sake.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 5.2: Case statements</h1>

<ul>
<li>Objective:

<ul>
<li>Add debian support to your apache manifest by using a case statement</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Move your package, config file and service name to variables</li>
<li>Add the variables as value for the namevar of your resources</li>
<li>Add a case statement setting the variables depending on the osfamily</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>If statement</h1>

<ul>
<li>Used to make a choice based on a truth value</li>
<li>Can use:

<ul>
<li>boolean value</li>
<li>conditional expressions </li>
<li>regular expressions</li>
<li>chain of expressions</li>
</ul>
</li>
</ul>

<pre>
if $ensure == 'present' or $ensure == 'installed' {
  package { 'telnet':
    ensure =&gt; present,
  }
} elsif $ensure =~ /^(absent|purged)$/ {
  package { 'telnet':
    ensure =&gt; purged,
  }
} else {
  fail("${ensure} is not valid")
}
</pre>

<div class="handouts">

<hr>

<p>The if statement allows to make a choice in your code based on a truth value.
This can be a simple boolean value (only <code>undef</code> and <code>false</code> evaluate as false),
a conditional expression or regular expression (doing a comparison) or a chain
of expressions (connected by <code>and</code> or <code>or</code> or negating an expression with <code>not</code>.</p>

<p>It can use additional expressions in an <code>elsif</code> and an <code>else</code> for false expressions.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/6">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Unless statement</h1>

<ul>
<li>Reversed if statement</li>
<li>No elsif clause possible</li>
</ul>

<pre>
unless $ensure =~ /^(absent|purged)$/ {
  package { 'telnet':
    ensure =&gt; present,
  }
} else {
  package { 'telnet':
    ensure =&gt; purged,
  }
}
</pre>

<div class="handouts">

<hr>

<p>The unless statement is like a reversed if statement, but does not allow elsif clauses.
The style guide does not mention unless statements but typically a if statement is much more
readable.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_03_conditionals" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/03_conditionals/7">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 5.3: If Statement</h1>

<ul>
<li>Objective:

<ul>
<li>Allow to purge the Apache webserver</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a if statement based on a variable ensure to set state of your resources</li>
<li>Use this variables in your resource declarations</li>
<li>Adjust the dependency chain based on ensure</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_04_functions" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/04_functions/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Functions</h1>

<ul>
<li>Always executed on the Master during Catalog Compilation</li>
<li>Two types:

<ul>
<li>
<strong>statement</strong> - executes an action</li>
<li>
<strong>rvalue</strong> - returns a value</li>
</ul>
</li>
<li>Basic functions included in Puppet, e.g.:

<ul>
<li>
<em>fail</em> - statement to fail catalog compilation with the provided message</li>
<li>
<em>template</em> - rvalue returning an erb template as string</li>
<li>
<em>versioncmp</em> - rvalue returning a number indicating if a version is higher or lower</li>
</ul>
</li>
<li>Additional functions can be provided by modules</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet allows to integrate functions into your manifests which will be executed on the Master during Catalog Compilation. </p>

<p>Statements can execute an action like <em>fail</em> which will fail catalog compilation with the provided message which is
useful as default in case statements for better failing than providing wrong parameters for an unsupported case.</p>

<div class="break">continued...</div>

<p>Rvalue functions return a value like the <em>template</em> function which takes an erb template and returns a string or
<em>versioncmp</em> which takes two version and returns "-1" if the first one is less, "0" if both are equal or "1" if
the first one is greater.</p>

<p>As with facts modules can include there own functions, for example the module puppetlabs/stdlib mainly exists to
provide additional functions.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_04_functions" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/04_functions/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Template Functions</h1>

<ul>
<li>
<em>template</em>

<ul>
<li>uses Embedded Ruby in templates</li>
<li>all variables in the scope are passed to the template</li>
<li>can handle multiple templates</li>
</ul>
</li>
<li>
<em>epp</em>

<ul>
<li>uses Embedded Puppet in templates</li>
<li>a hash with parameter has to be passed to the template</li>
<li>only available in Puppet 4</li>
</ul>
</li>
<li>an inline version of both functions exists</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet can not only handle static files, with the use of the <em>template</em> or <em>epp</em> function you can handle a file
containing dynamic content.</p>

<p>The <em>template</em> function exists in all versions of Puppet and uses Embedded Ruby (erb) for the dynamic parts.
Using the erb syntax you can access all variables available in the scope. The <em>template</em> function also can handle
multiple templates which will be concatenated.</p>

<div class="break">continued...</div>

<p>The <em>epp</em> function is only available in Puppet 4 (or with the future parser in some older versions) and uses
Embedded Puppet (epp) instead of Embedded Ruby. Furthermore it does only use the parameters which are passed to it
which are required if no default value is set and Puppet will fail then.</p>

<p>Furthermore an inline version of both functions exists which uses a string in heredoc format instead of a template
file. But for readability you should avoid this at least for bigger templates.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_04_functions" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/04_functions/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>ERB Syntax</h1>

<ul>
<li>Simple textfile including some Ruby code</li>
</ul>

<pre>
&lt;%# Comment not printed in file -%&gt;

&lt;% if @variable == true -%&gt;
Print this &lt;%= @variable %&gt;
&lt;% end -%&gt;

&lt;% @values.each do |value| -%&gt;
Value is &lt;%= value %&gt;
&lt;% end -%&gt;
</pre>

<div class="handouts">

<hr>

<p>An erb template consists simply of text and Ruby code embedded with &lt;% and %&gt;. In these lines of code
you can access variables from Puppet (prefixed with @ or accessed with the scope function) or local variables
(a simple string). Furthermore you can add conditions and iterations like the if and each in the example above.
You can also call out to Puppet functions using the scope function. Also note the -%&gt; in some lines which
will result in a non printed line.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_04_functions" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/04_functions/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 5.4: ERB Templates</h1>

<ul>
<li>Objective:

<ul>
<li>Move your vhost configuration to an erb template</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a erb template for your vhost</li>
<li>Change the resource to use the template instead of a static file</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_04_functions" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/04_functions/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>EPP Syntax</h1>

<ul>
<li>Simple textfile including some Ruby code</li>
</ul>

<pre>
&lt;%- | Boolean $variable = true,
      Array   $values
| -%&gt;
&lt;%# Comment not printed in file -%&gt;

&lt;% if $variable == true { -%&gt;
Print this &lt;%= $variable %&gt;
&lt;% } -%&gt;

&lt;% $values.each |value| { -%&gt;
Value is &lt;%= value %&gt;
&lt;% } -%&gt;
</pre>

<div class="handouts">

<hr>

<p>An epp template consists simply of text and Puppet code embedded with &lt;% and %&gt;. On top
of the file you should define the parameters required. If none are defined every parameter is accepted.
If a default value is set, the parameter is optional and if not passed to the epp function will fall
back to the default. In epp you do not require a special syntax to use Puppet functions instead you can
use them in the same ways like in your manifests.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_04_functions" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/04_functions/6">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 5.5: EPP Templates</h1>

<ul>
<li>Objective:

<ul>
<li>Create your webserver content from an epp template</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a epp template to represent your webserver content</li>
<li>Change the resource to use the template instead of fixed string</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_05_iteration" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/05_iteration/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Iteration</h1>

<ul>
<li>Puppet 4 introduced some iteration functions

<ul>
<li>
<strong>each</strong> - repeat a code block for each object</li>
<li>
<strong>slice</strong> - repeat a code block a given number of times</li>
<li>
<strong>filter</strong> - remove non-matching elements</li>
<li>
<strong>map</strong> - transform values to some data structure</li>
<li>
<strong>reduce</strong> - combine values to a new data structure</li>
<li>
<strong>with</strong> - create a private code block (no real iteration)</li>
</ul>
</li>
</ul>

<pre>
$binaries = ['facter', 'hiera', 'mco', 'puppet', 'puppetserver']

$binaries.each |String $binary| {
  file {"/usr/bin/${binary}":
    ensure =&gt; link,
    target =&gt; "/opt/puppetlabs/bin/${binary}",
  }
}
</pre>

<div class="handouts">

<hr>

<p>Puppet 4 introduced some iteration functions. Unlike most programming languages where an iteration is
a special keyword for a looping construct, Puppet has implemented it as functions that accept a block
of code.</p>

<p>The example above shows the <code>each</code> function taking every element of the "binaries" array as String and
creating a symlink for them.</p>

<div class="break">continued...</div>

<p>Other examples you can find on the iteration page in the docs: <a href="https://docs.puppet.com/puppet/latest/reference/lang_iteration.html">https://docs.puppet.com/puppet/latest/reference/lang_iteration.html</a></p>

<p>or on the function reference for a specific function: <a href="https://docs.puppet.com/puppet/latest/reference/function.html">https://docs.puppet.com/puppet/latest/reference/function.html</a></p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_code_logic_05_iteration" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/code_logic/05_iteration/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 5.6: Iteration</h1>

<ul>
<li>Objective:

<ul>
<li>Add multiple vhosts with an iteration</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Add a hash containing shortnames and ip addresses to the top of your manifest</li>
<li>Add an each loop around your resources</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_00_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/modules/00_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>6 Modules</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_02_modules" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/02_modules/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Modules</h1>

<ul>
<li>Modules are a pre-defined structure for encapsulating related configuration</li>
<li>This enables:

<ul>
<li>auto-loading of classes</li>
<li>file-serving for templates and files</li>
<li>auto-delivery of custom Puppet extensions</li>
<li>easy sharing with others</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Modules are a pre-defined structure for encapsulating related configuration which
enables the auto-loading of classes, file-serving for templates and files and 
auto-delivery of custom Puppet extensions. Furthermore it allows for easy sharing
with others. for this going to work a modules should be self-contained and should
have well defined integration points for other modules to use. It should manage
everything required but --more important-- not manage things out of it scope.</p>

<p>For example a web application module should not also manage the database or the
webserver because a module doing so would only allow the use of this single web
application with one specific database and webserver.</p>

<p>Defining the scope of modules is one of the hardest things to do with Puppet but
with some experience it gets easier.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_02_modules" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/02_modules/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Structure of Modules</h1>

<pre>
modulename
|-- facts.d        &lt;- external facts
|-- files          &lt;- static files
|-- lib
|   |-- facter     &lt;- facts written in Ruby
|   `-- puppet     &lt;- custom functions, types and providers
|-- manifests      &lt;- Puppet classes
|-- metadata.json  &lt;- Module description
|-- spec           &lt;- unit tests
|-- templates      &lt;- dynamic files in erb or epp syntax
`-- examples       &lt;- smoke tests
</pre>

<div class="handouts">

<hr>

<p>The example above shows the structure of a module. The outermost directory is named like
the module itself and contains a directory for every type of files. If a module does not
provide a specific type of files it does not require the corresponding directory. The file
'metadata.json' is optional and contains the description of the module in a machine readable
format. Some of the descriptions are used by tools, like the dependencies used by the <code>puppet
module</code> command.</p>

<p>In this training we will not cover custom functions and facts and we will only cover smoke
tests, no unit tests. Writing such things is covered in "Advanced Puppet".</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_02_modules" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/02_modules/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Autoloading</h1>

<p>Classes in <code>manifests</code></p>

<ul>
<li>Default class named like the module found in <code>init.pp</code>
</li>
<li>Classes in files matching there names

<ul>
<li>
<code>module::example</code> in <code>example.pp</code>
</li>
<li>
<code>module::example::complex</code> in <code>example/complex.pp</code>
</li>
</ul>
</li>
</ul>

<p>Files in <code>files</code></p>

<ul>
<li>Served by Puppet fileserver as 'puppet:///modules/<em>modulename</em>/<em>filename</em>'</li>
</ul>

<p>Templates in <code>templates</code></p>

<ul>
<li>Lookup by Puppet template functions like

<ul>
<li>Embedded Ruby: 'template(<em>modulename</em>/<em>filename.erb</em>)'</li>
<li>Embedded Puppet: 'epp(<em>modulename</em>/<em>filename.epp</em>)'</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Autoloading of classes is based on the namespace of the classes. The namespace always
starts with the modulename and the module's default class has to be named as the module.
This default class is located in the modules's init.pp in the manifests directory. Other
classes of the module must be named like the file providing them.</p>

<pre><code># grep ^class apache/manifests/init.pp
class apache (
# grep ^class apache/manifests/package.pp 
class apache::package (
# grep ^class apache/manifests/mod/status.pp 
class apache::mod::status (
</code></pre>

<p>Autoloading also works for static files served by the Puppet Master. Puppet uses its own
URL schema you can use as source attribute for files 'puppet:///modules/<em>modulename</em>/<em>filename</em>'.</p>

<p>Furthermore template lookup can use relative pathes for templates provided by a module
like 'template(<em>modulename</em>/<em>filename.erb</em>)' or 'epp(<em>modulename</em>/<em>filename.epp</em>)'.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_02_modules" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/02_modules/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 6.1: Modules</h1>

<ul>
<li>Objective:

<ul>
<li>Build a module to handle your apache class</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create the structure for your apache module</li>
<li>Move your manifest and all required files to this structure</li>
<li>Adjust the source of your file resource</li>
<li>Create a smoke test including your apache class</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_03_parameterized_classes" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/03_parameterized_classes/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Parameterized Classes</h1>

<ul>
<li>Classes can take parameters to change their behaviour</li>
<li>The parameters can have a defined data type with Puppet 4</li>
<li>Also with parameters a class is still a singleton</li>
</ul>

<pre>
class apache (
  Enum['running','stopped'] $ensure        = 'present',
  Boolean                   $enable        = true,
  Boolean                   $default_vhost = false,
  Hash[String, String]      $vhosts        = {},
) {
  ...
}
</pre>

<div class="handouts">

<hr>

<p>In Puppet classes can take parameters to change their behaviour to represent different
configurations. The parameters can have a defined data type with Puppet 4 which allows
for an easy validation, in Puppet 3 you had to stick to the validate functions provided
by puppetlabs/stdlib module.</p>

<p>Keep in mind also with parameters you can only handle one use case on one node because
classes are still singletons and can not be applied multiple times with different parameter
sets.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_03_parameterized_classes" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/03_parameterized_classes/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Declaring Parameterized Classes</h1>

<ul>
<li>
<code>include</code> function takes a class with all its defaults</li>
<li>you can declare a class like every resource with parameters</li>
</ul>

<pre>
class {'apache':
  ensure        =&gt; running,
  default_vhost =&gt; true,
}
</pre>

<div class="handouts">

<hr>

<p>To declare a parameterized class you can use the <code>include</code> function if you are fine
with all the defaults. This allows for including the class multiple times because
the include function will on declare a class not already declared.</p>

<p>Declaring a class like a resource can not be done multiple times but allows to
set parameters in the same way you set attributes of other resources.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_03_parameterized_classes" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/03_parameterized_classes/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 6.2: Parameterized Class</h1>

<ul>
<li>Objective:

<ul>
<li>Parameterize your apache class</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Promote the variable $ensure to be a parameter that handle the apache service</li>
<li>and a parameter $enable to set the behavoir during the system start.</li>
<li>Add a boolean parameter $ssl managing ssl support.</li>
<li>Write some smoke tests.</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_04_inheritance" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/04_inheritance/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Inheritance</h1>

<ul>
<li>Classes can inherit from other classes</li>
<li>Inheritance allows for special-case classes extending a base class

<ul>
<li>Inherits parameters, variables and resources</li>
<li>Allows to extend the class, override and append existing values</li>
<li>
<strong>But</strong> can also be handled with include and parameters</li>
</ul>
</li>
</ul>

<pre>
class base::freebsd inherits base::unix {
  File['/etc/passwd'] {
    group =&gt; 'wheel',
  }
  File['/etc/shadow'] {
    group =&gt; 'wheel',
  }
}
</pre>

<pre>
class apache::ssl inherits apache {
  Service['apache'] {
    require +&gt; [ File['apache.pem'], File['httpd.conf'] ],
  }
}
</pre>

<div class="handouts">

<hr>

<p>In Puppet inheritance between classes is possible which allows to build special-case classes
extending a base class. This child classes inherit parameters, variables and resources and
can extend the class, override and append existing values.</p>

<div class="break">continued...</div>

<p>This example show a class "base::freebsd" inheriting from "base::unix" and overwriting the
group attribute for some file resources using the reference on the already declared ones.</p>

<pre><code>class base::freebsd inherits base::unix {
  File['/etc/passwd'] {
    group =&gt; 'wheel',
  }
  File['/etc/shadow'] {
    group =&gt; 'wheel',
  }
}
</code></pre>

<p>Overwriting with <code>undef</code> can also be used to remove an attribute from inheritance. Puppet will
not manage this attribute if declaring the child class.</p>

<pre><code>class base::content inherits base {
  File['/path/to/some/file'] {
    source  =&gt; undef,
    content =&gt; template('base/file.erb'),
  }
}
</code></pre>

<p>Extending an attributes value list works for arrays and hashes and can be quite useful for
extended depenencies. It uses a special <code>+&gt;</code> instead of <code>-&gt;</code>.</p>

<pre><code>class apache::ssl inherits apache {
  Service['apache'] {
    require +&gt; [ File['apache.pem'], File['httpd.conf'] ],
  }
}
</code></pre>

<div class="break">continued...</div>

<p>Internally inheritance works by declaring the parent class first and allowing the child class
to override values. This can get complicated especially with the scope of variables, also
with the static scope in Puppet 4 it gets more predictable. But you can avoid inheritance in
the most cases by using <code>include</code> or <code>contain</code> and some class parameters.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_04_inheritance" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/04_inheritance/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Params.pp pattern</h1>

<ul>
<li>Seperate calculating default parameter from code

<ul>
<li>params.pp handles parameter calculation</li>
<li>main class inherits params</li>
<li>all parameters are set to default provided by params</li>
</ul>
</li>
<li>Only style guide conform use of inheritance</li>
</ul>

<pre>
class apache::params {
  case $::osfamily {
    'RedHat': {
       $httpd_user    = 'apache'
    }
    'Debian': {
       $httpd_user    = 'www-data'
    }
  }
}

class apache (
  $http_user = $apache::params::httpd_user,
) inherits apache::params {
  ...
}
</pre>

<div class="handouts">

<hr>

<p>The params.pp pattern is the only style guide conform use of inheritance.</p>

<div class="break">continued...</div>

<p>Its purpose is to seperate calculating default parameter from the actual code for configuration.
In a subclass params of the module is all the parameter calculation handled and the main class
inherits this class to access this parameters. This also requires that every parameter is set to
the default provided by params class.</p>

<p>An extended version of the example above:</p>

<pre><code>class apache::params {
  case $::osfamily {
    'RedHat': {
       $httpd_user    = 'apache'
       $httpd_group   = 'apache'
       $httpd_pkg     = 'httpd'
       $httpd_svc     = 'httpd'
       $httpd_conf    = 'httpd.conf'
       $httpd_confdir = '/etc/httpd/conf'
       $httpd_docroot = '/var/www/html'
    }
    'Debian': {
       $httpd_user    = 'www-data'
       $httpd_group   = 'www-data'
       $httpd_pkg     = 'apache2'
       $httpd_svc     = 'apache2'
       $httpd_conf    = 'apache2.conf'
       $httpd_confdir = '/etc/apache2'
       $httpd_docroot = '/var/www'
    }
    default: {
      fail("Module ${module_name} is not supported on ${::osfamily}")
    }
  }
}
</code></pre>

<div class="break">continued...</div>
    

<pre><code>class apache (
  $httpd_user    = $apache::params::httpd_user,
  $httpd_group   = $apache::params::httpd_group,
  $httpd_pkg     = $apache::params::httpd_pkg,
  $httpd_svc     = $apache::params::httpd_svc,
  $httpd_conf    = $apache::params::httpd_conf,
  $httpd_confdir = $apache::params::httpd_confdir,
  $httpd_docroot = $apache::params::httpd_docroot,
) inherits apache::params {

  file { $httpd_docroot:
    ensure =&gt; directory,
  }

  file { "${httpd_docroot}/index.html":
    ensure  =&gt; file,
    content =&gt; template('apache/index.html.erb'),
  }

  apache::vhost { $::fqdn:
    docroot =&gt; $httpd_docroot,
  }
  ...
}
</code></pre>

<p>With Puppet 4 a new functionality named "Data in Modules" is available which can possibly replace
this widely adopted pattern. One of the possible ways to do so we will see later.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_04_inheritance" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/04_inheritance/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 6.3: Params.pp pattern</h1>

<ul>
<li>Objective:

<ul>
<li>Move the default parameters of your apache class to a seperate class</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a params class providing your default parameters</li>
<li>Remove the parameter calculation based on osfamily from your main class</li>
<li>Inherit your params class and use its values as default</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_05_defined_resources" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/05_defined_resources/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Defined Resources</h1>

<ul>
<li>Very similar to parameterized classes</li>
<li>But can be used multiple times</li>
</ul>

<pre>
define apache::vhost (
    $docroot,
    $port       = '80',
    $priority   = '10',
    $options    = 'Indexes MultiViews',
    $vhost_name = $title,
    $servername = $title,
 ) {
  file { "/etc/httpd/conf.d/${title}.conf":
    ensure  =&gt; file,
    owner   =&gt; 'apache',
    group   =&gt; 'apache',
    mode    =&gt; '0644',
    content =&gt; template('apache/vhost.conf.erb'),
    notify  =&gt; Service['httpd'],
  }
}
</pre>

<div class="handouts">

<hr>

<p>Defined Resources are very similar to parameterized classes but it is used
to define your own resource which can be declared multiple times. This helps
to save time and lines of code, abstract complexity and reduce errors and
inconsistency.</p>

<div class="break">continued...</div>

<p>It is very important two keep in mind that all resources declared in defined
resources still have to be unique. For this Puppet provides an internal
variable $title providing the title of a resource which should be used on every
resource title declared inside the defined resource.</p>

<p>Also for autoloading defined resources are placed in the same way like classes.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_05_defined_resources" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/05_defined_resources/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Declaring Defined Resources</h1>

<ul>
<li>Declared like every other resource</li>
<li>Using hash to declare multiple defined resources

<ul>
<li>create_resources function
<pre>
create_resources(type, $resources_hash, $defaults_hash)
</pre>
</li>
<li>iteration
<pre>
each($resources_hash) |$name, $resource| { 
Â Â type{
Â Â Â Â default:
Â Â Â Â Â Â *Â =&gt;Â $defaults;Â 
Â 
Â Â Â Â $name:
Â Â Â Â Â Â *Â =&gt;Â $resource
Â Â }
}
</pre>
</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<div class="break">continued...</div>

<p>You can simply declare a defined resource using the same syntax like for all other
resources. One common use case is providing a hash of resources and perhaps an additional
hash with defaults. In Puppet 3 you only could do this with the create_resources function,
this was a nice feature when released but because it works a bit too magical internally
some people tried to avoid it. Iteration in Puppet 4 now provides a native way to do the
same combined with the alternative default syntax if setting defaults is required.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_modules_05_defined_resources" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/modules/05_defined_resources/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 6.4: Defined Resources</h1>

<ul>
<li>Objective:

<ul>
<li>Create a defined resource apache::vhost from your manifest</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a defined resource apache::vhost</li>
<li>Change the path of the templates from absolute to relative</li>
<li>Add a smoke test to apply multiple vhosts</li>
</ul>
</li>
<li>Optional:

<ul>
<li>Expand your defined resource to notify the service</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_00_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/master/00_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>7 Puppet Master</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_01_basics" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/01_basics">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Master</h1>

<ul>
<li>Master

<ul>
<li>Classic implementation in Ruby</li>
<li>Runs as standalone (up to ten nodes) or with a webserver</li>
</ul>
</li>
<li>Server

<ul>
<li>Newer implementation in jRuby</li>
<li>Runs in JVM</li>
<li>Higher resource requirements but scales better</li>
</ul>
</li>
<li>Share some configuration</li>
</ul>

<div class="handouts">

<hr>

<p>For the training we the master is already installed and running on a separate system.</p>

<p>We used for this the standalone version which runs under Webrick, a small ruby webserver.
Its performance is enough for up to ten nodes and it has the lowest requirements. But
it is declared deprecated with Puppet 4.</p>

<p>Another version would be to run the master with a webserver capable of serving ruby code,
in most setups this is Apache with Passenger. This scales very well both vertically and
horizontally. Build this setup without compiling components on your on got complicated with
the all-in-one packages provided by the vendor.</p>

<div class="break">continued...</div>

<p>The vendors recommendation is to use the newest incarnation the Puppet server which executes
the code as jRuby in a JVM. This is typically the fastest approach for running Ruby code.
This results in higher resource requirements using Java but should scale even better than
Apache with Passenger or similar solutions. </p>

<p>The server is nearly a drop-in replacement, using the same configuration from puppet.conf
and other master specific configuration files, but some small difference can be noticed.
Listed on <a href="https://docs.puppet.com/puppetserver/2.3/puppetserver_vs_passenger.html">https://docs.puppet.com/puppetserver/2.3/puppetserver_vs_passenger.html</a></p>

<p>While the vendor recommends the server, Netways still recommends Apache and Passenger for
being a stable solution if you encounter problems with the server.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_02_agent" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/02_agent/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Communication</h1>

<ul>
<li>Agent is configured to connect to a server

<ul>
<li>Explicitly set in configuration</li>
<li>DNS service record</li>
<li>FQDN puppet.domain</li>
</ul>
</li>
<li>Certificate used for authentication

<ul>
<li>Agent will create a certificate request on first run</li>
<li>Puppet CA signs the requested certificate</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>To point the agent to a server you have to configure it in its
configuration file. If not explicitly configured it will search
for an DNS service record and if not found falls back to use a
server puppet with the same domain as the agent.</p>

<p>On its run the agent will download the certificate authority's 
certificate and create a certificate request and send it to the
master. On the master you have to sign the request and the agent
get its certificate on the next run. Managing the Puppet CA is done
with the command 'puppet cert'.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_02_agent" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/02_agent/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 7.1: Communication</h1>

<ul>
<li>Objective:

<ul>
<li>Establish the communication between agent and master</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Configure the agent to connect to the master</li>
<li>Execute a puppet agent run</li>
<li>Sign the certificate</li>
<li>Execute another run</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_02_agent" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/02_agent/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Agent as service</h1>

<ul>
<li>Agent runs as a service

<ul>
<li>Interval is configureable</li>
<li>Splay can be added for spread agent runs</li>
<li>Default interval is 30 minutes</li>
</ul>
</li>
<li>Cronjob can be used as alternative</li>
<li>On demand is also possible</li>
</ul>

<div class="handouts">

<hr>

<p>Typically you want to enable the agent as a service which will execute a run every 30 minutes.
This interval could be changed in the agents configuration and it could also be randomized
but enabling splay which is best used in enviroments starting a huge amount of systems at once.</p>

<p>Instead of running the agent as service you can run it as cronjob which allows for a more detailed
configuration like only executing runs during workhours.</p>

<p>Running Puppet only on demand is also a valid option for some enviroments but typically you will
want to remediate drifts in a regular manor. Instead of login to every system for manually executing
the agent establishing an orchestation solution like MCollective or Foreman's remote execution plugin
is recommended for this setups.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_03_environments" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/03_environments">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Environments</h1>

<ul>
<li>Environments allow to serve different code to different stages</li>
<li>Directory enviroments

<ul>
<li>Path set on the master to serve an environment per directory</li>
<li>Directory contains a main manifest and modules</li>
</ul>
</li>
<li>Assignment

<ul>
<li>Node configuration requests an environment</li>
<li>Server can override it</li>
</ul>
</li>
<li>Default environment: <em>production</em>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet Master can handle multiple environments to separate agents and
serve them different versions of the Puppet code.</p>

<p>With Puppet 3.7 so called Directory enviroments were added which are now
the only supported option. This means only the environment path is set
on the master and simply every directory in this path represents an
environment. This directory contains a main mainfest and modules and allows
some addition configuration.</p>

<div class="break">continued...</div>

<p>An environment is assigned to a node in its local configuration. Although if
the agent requests a specific environment when the server is configured to
serve another one for the host it will override the agents configuration. If
nothing is configured an environment <em>production</em> is used per default.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_04_git_workflow" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/04_git_workflow/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Deploying code to Puppet Master</h1>

<ul>
<li>Ensure code is valid

<ul>
<li>Syntax validation</li>
<li>Style guide conformity</li>
</ul>
</li>
<li>Use environments for staging

<ul>
<li>No direct deployment in production</li>
</ul>
</li>
<li>Use version control system

<ul>
<li>History of changes</li>
<li>Enables Collaboration </li>
<li>Hooks enable automatic validation and deployment</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Your workflow for deploying code to the Puppet Master should include steps
to ensure only valid code is deployed. This includes validation against
syntax and style guide conformity. Also changes should be tested before
deploying them in production. Best is to use some kind of staging which could
mean using well-established stages also for your puppet environment or creating
new ones only for puppet. This stages can be represented by separate environments.</p>

<div class="break">continued...</div>

<p>It is recommended to use a version control system to help with this. It will
also allow you to view the history of changes with the possiblity to revert
specific problematic changes and define a changeset which should move to the
next stage. Most version control systems allows to add hooks to automate
validation and deployment.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_04_git_workflow" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/04_git_workflow/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Git</h1>

<ul>
<li>Open Source</li>
<li>Distributed

<ul>
<li>Most operations are local</li>
<li>Central repository for collaboration</li>
</ul>
</li>
<li>Cryptographic integrity of content and history</li>
</ul>

<div class="handouts">

<hr>

<p>The recommended version control system is <strong>git</strong>. Git is an open source distributed
version control system. Most operations are performed locally which results in a very
fast performance and a central repository enables collaboration which git supports with
easy branching, staging and enabling different workflows. Git also ensure integrity not
only on the content but also on commit history.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_04_git_workflow" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/04_git_workflow/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Git Commands</h1>

<ul>
<li>
<code>git status</code> - print the state of the working directory</li>
<li>
<code>git add</code> - add changes to the staging area to build a commit</li>
<li>
<code>git commit</code> - takes a snapshot, saves a checkpoint and a message as one commit</li>
<li>
<code>git push</code> - push a commit from local working directory to central repository</li>
<li>
<code>git pull</code> - pull from a central repository to local working directory</li>
<li>
<code>git diff</code> - show local changes in diff format</li>
<li>
<code>git log</code> - print the log of commits</li>
<li>
<code>git show</code> - print content of a commit</li>
<li>
<code>git blame</code> - show author and date of specified content</li>
<li>
<code>git branch</code> - list, create, delete local branches</li>
<li>
<code>git checkout</code> - change to specific branch</li>
<li>and many more</li>
</ul>

<div class="handouts">

<hr>

<div class="break">continued...</div>

<p>Git enables you to do many different things with your version control system, but
for your basic workflow you will require a small set of commands and others just
enable advanced workflow and error handling.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_04_git_workflow" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/04_git_workflow/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 7.2: Git Workflow</h1>

<ul>
<li>Objective:

<ul>
<li>Bring your puppet code under version control</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Use git status to find pending changes</li>
<li>Add them with git add to the staging area</li>
<li>Create your initial commit</li>
<li>Push it to the Puppet Master</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_04_git_workflow" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/04_git_workflow/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Background information</h1>

<ul>
<li>Preparation on your master

<ul>
<li>A shared repository for your puppet code</li>
<li>A git hook doing syntax validation</li>
<li>A git hook populating your puppet environment</li>
</ul>
</li>
<li>On your development system

<ul>
<li>A local clone of the repository</li>
<li>Access to the central repository</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>For the workflow from the exercise to work there are some preparations already done.</p>

<p>On the master a shared repository is created and then some git hooks for Puppet are added
using git.</p>

<pre><code>$ sudo useradd -G puppet git
$ su - git
$ git init --bare puppet.git
$ git clone https://github.com/drwahl/puppet-git-hooks.git puppet-validation-hooks
$ ln -s /home/git/puppet-validation-hooks/pre-receive /home/git/puppet.git/hooks/pre-receive
$ vi /home/git/puppet-validation-hooks/commit_hooks/config.cfg
CHECK_PUPPET_LINT="permissive"
</code></pre>

<div class="break">continued...</div>

<pre><code>$ git clone https://github.com/adrienthebo/puppet-git-hooks.git puppet-deployment-hooks
$ ln -s /home/git/puppet-deployment-hooks/post-receive/dynamic-environments /home/git/puppet.git/hooks/post-receive
$ vi /home/git/puppet.git/hooks/post-receive
...
ENVIRONMENT_BASEDIR = "/etc/puppetlabs/code/environments"
...
BRANCH_MAP = {
  "master" =&gt; "production",
}
...
$ sudo rm -rf /etc/puppetlabs/code/environments/production
$ sudo chown git.puppet /etc/puppetlabs/code/environments
</code></pre>

<p>On your development system the repository was cloned and a ssh key without passphrase was
created and added to the keys authorized to access the git repository.</p>

<pre><code>$ git clone git@puppet.localdomain:puppet.git
</code></pre>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_05_nodedeclaration" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/05_nodedeclaration/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Node Declaration</h1>

<ul>
<li>Nodes are another resource type</li>
<li>Only objects not declared in modules</li>
<li>Matching

<ul>
<li>Exact match</li>
<li>Regex</li>
<li>Fuzzy name matching</li>
<li>Default</li>
</ul>
</li>
</ul>

<pre>
node 'www.example.com' {
  include apache
}

node /\.example\.com$/ {
  include base
}

node default {
  notice('Node not configured')
}
</pre>

<div class="handouts">

<hr>

<p>Nodes are just another resource to be declared. The title of the resource will be matched against
the nodes certificate name. For this it will use the exact name, if not found it will look for a
regular expression matching (avoid multiple matching regex because puppet will not guarantee which
is used), if not regex is found it will start choping domain parts from the fqdn and if also this
does not provide a match the default node will be used.</p>

<div class="break">continued...</div>

<p>Typically you will not want to assign configuration to the default node and instead print a message
showing nodes not properly configured. If you want to configure multiple identic nodes you can provide
them also as comma separated list instead of regular expression. This configuration is done in the
main manifest which is by default the site.pp.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_05_nodedeclaration" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/05_nodedeclaration/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 7.3: Node Declaration</h1>

<ul>
<li>Objective:

<ul>
<li>Create a node declaration for your agent</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a node declaration for your agent</li>
<li>Create a default node declaration printing a notice</li>
<li>Commit and push it to your server</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_05_nodedeclaration" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/05_nodedeclaration/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>ENC</h1>

<ul>
<li>External Node Classifier is an alternative to site.pp</li>
<li>Script providing a node declaration in yaml format

<ul>
<li>Simple script logic</li>
<li>Query configuration management database</li>
<li>Communication with a web frontend</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>An alternative to the file based configuration would be an External Node Classifier.
This is not mutually exclusive instead both sources of configuration will be merged,
but normally you will only use one.</p>

<p>The ENC is configured in the master section of the configuration file and can be any
script providing a node declaration in yaml format. Using simple script logic to
generate yaml output based on the certificate name provided, querying a configuration
management database or similar sources or using it as communication interface with
a web frontend like Puppet Enterprise Console or Foreman are all valid options.</p>

<p>For more on ENC see <a href="https://docs.puppet.com/guides/external_nodes.html">https://docs.puppet.com/guides/external_nodes.html</a>.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_06_hiera" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/06_hiera/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Parameter Lookup</h1>

<ul>
<li>Separation of configuration and data</li>
<li>Automatic Lookup of parameters was introduced in Puppet 3</li>
<li>Improvements in Puppet 4.9</li>
<li>Default is

<ul>
<li>Hiera, a hierachical lookup</li>
<li>One global configuration</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Puppet 3 added an automatic lookup of parameters to allow the separation
of configuration and data. The tool used for this is Hiera, a hierachical
lookup. With Puppet 4.9 it was improved to add three layers of lookup, the
classic global hiera, environment data and module data.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_06_hiera" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/06_hiera/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Hiera</h1>

<ul>
<li>Hierarchy of lookups is configurable

<ul>
<li>Hierarchy level can be fix or use variables</li>
<li>Hiera 4 was never released as stable, replaced in Puppet 4.9</li>
<li>Environment and module configuration uses Hiera 5</li>
</ul>
</li>
<li>Different backends are avaiable

<ul>
<li>YAML/JSON - default</li>
<li>EYAML - YAML with encrypted fields</li>
<li>MySQL/PostgreSQL - Database lookup</li>
<li>LDAP and more</li>
</ul>
</li>
</ul>

<pre>
---
version: 5
defaults:
  datadir: data
  data_hash: yaml_data
hierarchy:
  - name: "Per-node data (yaml version)"
    path: "%{::hostname}.yaml"
  - name: "Other YAML hierarchy levels"
    paths:
      - "%{::domain}.yaml"
      - "defaults.yaml"
</pre>

<div class="handouts">

<hr>

<p>Hiera 3 uses a different configuration format, has less capabilities and is
deprecated since Pupept 4.9. Hiera now is complete integrated in Puppet. Hiera 3
was a seperated project. The hierachy levels can be a fix string or use variables
from Puppet. With version 5 the file suffix i.e. .yaml is required.</p>

<p>All features and the complete syntax is described in the online documentation:
<a href="https://docs.puppet.com/puppet/4.9/hiera_config_yaml_5.html">https://docs.puppet.com/puppet/4.9/hiera_config_yaml_5.html</a></p>

<p>Note: The old hiera_* functions are deprecated now and should be relaced with the
lookup function.</p>

<p>The new lookup function has an options hash to configure the search and merge behavoir.
See <a href="https://docs.puppet.com/puppet/4.9/hiera_merging.html">https://docs.puppet.com/puppet/4.9/hiera_merging.html</a>.</p>

<div class="break">continued...</div>

<p>The automatic lookup uses the namespace to find a variable, for example parameter
manage_service of module apache has to be apache::manage_service for the automatic lookup.</p>

<p>Hiera can utilize different backends which are pluggable. Per default it only
provides a file based configuration in YAML or JSON format. Other common formats
are eYAML which adds encrypted fields to default YAML or Database lookups. Furthermore
specific solutions like Foreman are avaiable which use an existing datastore as backend.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_06_hiera" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/06_hiera/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 7.4: Environment Data</h1>

<ul>
<li>Objective:

<ul>
<li>Create a parameterized apache configuration using hiera</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Use Hiera for environment data</li>
<li>Enable ssl per default</li>
<li>Add a new parameter to accept a hash of vhosts</li>
<li>Define the vhost hash for your client</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_06_hiera" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/06_hiera/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Data in modules</h1>

<ul>
<li>Similar to environment data</li>
<li>Could replace params.pp pattern

<ul>
<li>No inheritance</li>
<li>Better separation between code and data</li>
<li>Easier enhanced for supporting additional operatingsystems</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>Data in modules could replace perhaps the params.pp pattern commonly used for
separation of parameters from code logic. A good blogpost on this can be found
on <a href="https://www.devco.net/archives/2016/01/08/native-puppet-4-data-in-modules.php">https://www.devco.net/archives/2016/01/08/native-puppet-4-data-in-modules.php</a></p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_07_roles_profiles_pattern" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/master/07_roles_profiles_pattern/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Roles-Profile-Pattern</h1>

<ul>
<li>Puppet is all about abstraction</li>
<li>Wants to simplify things</li>
<li>Good module design

<ul>
<li>compose system configuration</li>
<li>interchangeable</li>
</ul>
</li>
<li>Roles-Profile-Pattern takes this to the next level

<ul>
<li>Component Modules - technical implementation</li>
<li>Profile - site specific implementation</li>
<li>Role - business logic</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>The Roles-Profile-Pattern is a design pattern that takes the Puppet approach to the next level.</p>

<p>It was designed by Craig Dunn to simplifiy node declaration by abstracting modules even more.
It requires a good module design so you can compose a system's configuration from interchangeable
parts. In this design a component module abstracts the technical implementation and tries to parameterize
in a way a module is useable for every possible scenario. How this module is used in a specfic enviroment
is then declared on the next level the so called profiles. The role of a system then builds the business
logic on top of this profiles.</p>

<div class="break">continued...</div>

<p>The inital idea is explained on <a href="http://www.craigdunn.org/2012/05/239/">http://www.craigdunn.org/2012/05/239/</a> and the next slides will give you
an example.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_07_roles_profiles_pattern" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/master/07_roles_profiles_pattern/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Roles-Profiles-Pattern - Component Modules</h1>

<p><img src="./file/sections/master/./_images/rolesprofilespattern_component.png" width="894" height="215" style="float: center; margin-left: 50px; width: 800px; height: 192px;" alt="Roles-Profiles-Pattern - Component Modules"></p>

<pre>
    class apache (
      $apache_name            = $::apache::params::apache_name,
      $service_name           = $::apache::params::service_name,
      $default_mods           = true,
      $default_vhost          = true,
      ...

    define apache::vhost(
      $docroot,
      $manage_docroot              = true,
      $virtual_docroot             = false,
      $port                        = undef,
      ...
</pre>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_07_roles_profiles_pattern" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/master/07_roles_profiles_pattern/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Roles-Profiles-Pattern - Profiles</h1>

<p><img src="./file/sections/master/./_images/rolesprofilespattern_profiles.png" width="894" height="315" style="float: center; margin-left: 50px; width: 800px; height: 282px;" alt="Roles-Profiles-Pattern - Profiles"></p>

<pre>
     class profiles::base {
       include ssh
       include postfix::mta

       class { 'motd':
         template =&gt; 'profiles/motd_base.erb'
       }
</pre>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_07_roles_profiles_pattern" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/master/07_roles_profiles_pattern/4">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Roles-Profiles-Pattern - Roles</h1>

<p><img src="./file/sections/master/./_images/rolesprofilespattern_roles.png" width="894" height="415" style="float: center; margin-left: 50px; width: 800px; height: 371px;" alt="Roles-Profiles-Pattern - Roles"></p>

<pre>
     class roles::webserver::external {
       include profiles::base::hardening
       include profiles::webserver::typo3
     }
</pre>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_master_07_roles_profiles_pattern" class="slide smbullets small noprint" data-transition="none">
<div class="content smbullets small noprint" ref="sections/master/07_roles_profiles_pattern/5">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Roles-Profiles-Pattern - Stack</h1>

<p>Best combined with an External Node Classifier and Hiera for even more simplification</p>

<p><img src="./file/sections/master/./_images/rolesprofilespattern_stack.png" width="1293" height="415" style="float: center; margin-left: 50px; width: 800px; height: 257px;" alt="Roles-Profiles-Pattern - Stack"></p>

<ul>
<li>Node Assignment without deeper knowledge</li>
<li>Profile creation requires more internal know-how than about application</li>
<li>Component modules require application know-how not internal</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_00_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/forge/00_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>8 Puppet Forge</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_01_basics" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/01_basics/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Forge</h1>

<p><a href="http://forge.puppet.com">http://forge.puppet.com</a></p>

<ul>
<li>Community plattform for modules

<ul>
<li>4000+ Modules by many different authors</li>
<li>Searchable</li>
<li>Supported and Approved Modules</li>
<li>Number of Downloads and Scoring system</li>
</ul>
</li>
<li>Command Line Interface <code>puppet module</code>

<ul>
<li>Search</li>
<li>Install</li>
<li>List installed modules</li>
</ul>
</li>
</ul>

<div class="notes">

<ul>
<li>Supported Module: Support included with PE, tested and compatibility matrix avaiable</li>
<li>Approved Module: Pass specific quality and usability requirements, recommended but not supported</li>
</ul>

</div>

<div class="handouts">

<hr>

<p>With the Puppet Forge provides the vendor a community plattform for modules with a still growing number
of modules by many different authors, projects and companies. The website is searchable to easly find a
module managing a specific software or solving a common problem. For quality indicators look for modules
markes as supported which are included in support offered with Puppet Enterprise, tested and a compatibility
matrix is given or approved which pass specific quality and usability requirements and are recommended but
not supported. Other indicators are the number of downloads, the scoring system combining user scores and
automatic tests and if provided the number of open issues.</p>

<div class="break">continued...</div>

<p>The Forge is also usable through a Command Line Interface which allows to search, install (including dependencies)
and also list all installed modules, but of course requires internet access.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_01_basics" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/01_basics/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 8.1: Forge</h1>

<ul>
<li>Objective:

<ul>
<li>Install the stdlib module provided by puppetlabs</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Search the Forge</li>
<li>Install the module</li>
<li>List all installed modules</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_01_basics" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/01_basics/3">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Working with the Forge</h1>

<ul>
<li>Use as there are

<ul>
<li>Documentation</li>
<li>Parameterized</li>
<li>Push changes upstream</li>
<li>Wrap around them</li>
</ul>
</li>
<li>Use as inspiration

<ul>
<li>Keep it simple</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>There are two ways to use the Forge for its best.</p>

<p>Easiest way is to use the modules as they are. Read the documentation and have a look at the code
to see if a module can solve your problem. Most modules are parameterized in a way to solve most
problems and support different plattforms. If you require changes try to incorporate them without
breaking and push them upstream like adding another plattform. If you can not or do not want to
bring changes upstream try to only wrap aroung the module with a custom module. Both ways you keep
the module upgradable so you do not have to maintain it on your own after installation.</p>

<div class="break">continued...</div>

<p>Most forge modules support multiple plattforms and many different scenarios, many are over-engineered
for one specific environment or in a style you do not like but can still be used as inspiration.
So in some cases creating your own simple module solving your problem in a way you can understand and
maintain is more usefull than simply taking a module from the forge and work around it.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_02_puppetdb" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/02_puppetdb/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>PuppetDB</h1>

<ul>
<li>Data store:

<ul>
<li>Facts (last run)</li>
<li>Catalog (last run)</li>
<li>Reports (optional, timeframe configurable)</li>
</ul>
</li>
<li>Enables:

<ul>
<li>Features like exported resources</li>
<li>API to query the data</li>
</ul>
</li>
<li>Uses:

<ul>
<li>Clojure (dialect of Lisp run in JVM)</li>
<li>PostgreSQL</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>The PuppetDB is a data store developed from Puppet to store facts, catalogs and reports and
enables features like exported resources in Puppet and other tools to easily access this data.
For performance reasons it was written in Clojure, a dialect of Lisp run in JVM, using PostgreSQL
as backend.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_02_puppetdb" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/02_puppetdb/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 8.2: PuppetDB</h1>

<ul>
<li>Objective:

<ul>
<li>Install PuppetDB using the Puppet module</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Install the PuppetDB module</li>
<li>Assign it to your master</li>
<li>Run the puppet agent to install it</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_03_puppetexplorer" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/03_puppetexplorer/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Puppet Explorer</h1>

<ul>
<li>Explore data from PuppetDB

<ul>
<li>Facts</li>
<li>Resources from Catalog</li>
<li>Reports</li>
</ul>
</li>
<li>Enables:

<ul>
<li>Filtering</li>
<li>Drilldown</li>
</ul>
</li>
<li>Uses:

<ul>
<li>AngularJS and CoffeeScript</li>
<li>PuppetDB and Webserver</li>
</ul>
</li>
</ul>

<div class="handouts">

<hr>

<p>The Puppet Explorer is a web application for PuppetDB that lets you explore your Puppet data.
It uses the same query language like puppetdbquery which could be used in also as function in
your modules for filtering and its charts allow to do a drilldown simply by clicking.</p>

</div>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_forge_03_puppetexplorer" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/forge/03_puppetexplorer/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 8.3: Puppet Explorer</h1>

<ul>
<li>Objective:

<ul>
<li>Install Puppet Explorer using the Puppet module</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Install the Puppet Explorer module</li>
<li>Assign it to your master</li>
<li>Run the puppet agent to install it</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_optional_00_overview" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/optional/00_overview">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>9 Optional</h1>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_optional_01_optional" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/optional/01_optional">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 9.1: Optional</h1>

<ul>
<li>Objective:

<ul>
<li>Test and expand the debian support of your module</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Connect the agent on agent-debian.localdomain to your master</li>
<li>Assign it the apache class like you did with agent-centos</li>
<li>Fix your module if required</li>
<li>Expand your module in the way you want it</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="sections_optional_02_profile" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/optional/02_profile">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Lab 9.2: Optional</h1>

<ul>
<li>Objective:

<ul>
<li>Create a base profile</li>
</ul>
</li>
<li>Steps:

<ul>
<li>Create a module for your profiles</li>
<li>Find modules in the forge for configuring infrastructure services</li>
<li>Use these modules and hiera to create a base profile </li>
<li>Assign this profile to your agents</li>
</ul>
</li>
</ul>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="global_Post_01_Feedback" class="slide noprint center" data-transition="none">
<div class="content noprint center" ref="global/Post/01_Feedback">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>FEEDBACK</h1>

<p>We look forward to your feedback</p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="global_Post_02_Thanks" class="slide noprint center" data-transition="none">
<div class="content noprint center" ref="global/Post/02_Thanks">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>THANK YOU</h1>

<p>Thank you for your attention!</p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="global_Post_03_Contributors" class="slide noprint center" data-transition="none">
<div class="content noprint center" ref="global/Post/03_Contributors/1">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Contributing</h1>

<p>Contribute to the Puppet training on <a href="https://github.com/NETWAYS/fundamentals4puppet-training">Github</a> to make it even better.</p>

<p>Material is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
<div id="global_Post_03_Contributors" class="slide noprint small" data-transition="none">
<div class="content noprint small" ref="global/Post/03_Contributors/2">
<div id="net-header">
    <div class="logo"></div>
</div>

<h1>Contributors</h1>

<pre>
Lennart Betz
Dirk GÃ¶tz
</pre>

<div id="net-footer">
    <p id="footer-left">Fundamentals for Puppet Training</p>
    <p id="footer-right">by NETWAYS GmbH (www.netways.de)</p>
</div>
</div>
</div>
</div>
<div id="pauseScreen">
  PAUSED
</div>

</body>
</html>
